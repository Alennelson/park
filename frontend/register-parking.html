<!DOCTYPE html>
<html>
<head>
  <title>Register Parking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="config.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #FFD400;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .phone {
      width: 360px;
      height: 700px;
      background: #FFD400;
      border-radius: 30px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.4);
      padding: 15px;
      overflow-y: auto;
    }

    input, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: none;
      font-size: 14px;
    }

    textarea {
      resize: none;
      height: 70px;
    }

    #map {
      width: 100%;
      height: 180px;
      border-radius: 12px;
      margin-top: 10px;
    }

    button {
      background: black;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="phone">

  <h2>Register Parking Space</h2>

  <textarea id="notes" placeholder="Notes / Specification"></textarea>

  <!-- VEHICLE TYPES WITH PRICING -->
  <div style="background: #FFC800; padding: 15px; border-radius: 10px; margin: 10px 0;">
    <h4 style="margin: 0 0 10px 0;">Vehicle Types & Pricing (‚Çπ/hour):</h4>
    
    <label style="display: block; margin: 12px 0; font-size: 14px;">
      <input type="checkbox" id="vehicleCar" value="car" style="width: auto; margin-right: 8px;" onchange="togglePriceInput('Car')">
      üöó Car
    </label>
    <input id="priceCar" type="number" placeholder="Price per hour for Car (‚Çπ)" style="display: none; margin-left: 25px; width: calc(100% - 25px);">
    
    <label style="display: block; margin: 12px 0; font-size: 14px;">
      <input type="checkbox" id="vehicleBike" value="bike" style="width: auto; margin-right: 8px;" onchange="togglePriceInput('Bike')">
      üèçÔ∏è Bike/Motorcycle
    </label>
    <input id="priceBike" type="number" placeholder="Price per hour for Bike (‚Çπ)" style="display: none; margin-left: 25px; width: calc(100% - 25px);">
    
    <label style="display: block; margin: 12px 0; font-size: 14px;">
      <input type="checkbox" id="vehicleBus" value="bus" style="width: auto; margin-right: 8px;" onchange="togglePriceInput('Bus')">
      üöå Bus
    </label>
    <input id="priceBus" type="number" placeholder="Price per hour for Bus (‚Çπ)" style="display: none; margin-left: 25px; width: calc(100% - 25px);">
    
    <label style="display: block; margin: 12px 0; font-size: 14px;">
      <input type="checkbox" id="vehicleHeavy" value="heavy" style="width: auto; margin-right: 8px;" onchange="togglePriceInput('Heavy')">
      üöõ Heavy Vehicle/Truck
    </label>
    <input id="priceHeavy" type="number" placeholder="Price per hour for Heavy Vehicle (‚Çπ)" style="display: none; margin-left: 25px; width: calc(100% - 25px);">
  </div>

  <!-- IMAGE UPLOAD -->
  <input id="images" type="file" accept="image/*" multiple>

  <!-- MAP -->
  <div id="map"></div>

  <button onclick="registerParking()">Save Parking Space</button>

</div>

<script>
let lat = null;
let lng = null;
let map, marker;

/* INIT MAP */
function initMap() {
  const defaultLoc = { lat: 9.9312, lng: 76.2673 };

  map = new google.maps.Map(document.getElementById("map"), {
    center: defaultLoc,
    zoom: 14,
  });

  map.addListener("click", (e) => {
    lat = e.latLng.lat();
    lng = e.latLng.lng();

    if (marker) marker.setMap(null);

    marker = new google.maps.Marker({
      position: { lat, lng },
      map: map,
    });
  });
}

/* TOGGLE PRICE INPUT */
function togglePriceInput(vehicleType) {
  const checkbox = document.getElementById(`vehicle${vehicleType}`);
  const priceInput = document.getElementById(`price${vehicleType}`);
  
  if (checkbox.checked) {
    priceInput.style.display = 'block';
  } else {
    priceInput.style.display = 'none';
    priceInput.value = '';
  }
}

/* REGISTER PARKING */
function registerParking() {
  const notes = document.getElementById("notes").value;
  const files = document.getElementById("images").files;
  const ownerId = localStorage.getItem("ownerId");

  // Get selected vehicle types with prices
  const vehicleTypes = [];
  const pricing = {};
  
  if (document.getElementById("vehicleCar").checked) {
    const price = document.getElementById("priceCar").value;
    if (!price) {
      alert("Please enter price for Car");
      return;
    }
    vehicleTypes.push("car");
    pricing.car = parseFloat(price);
  }
  
  if (document.getElementById("vehicleBike").checked) {
    const price = document.getElementById("priceBike").value;
    if (!price) {
      alert("Please enter price for Bike");
      return;
    }
    vehicleTypes.push("bike");
    pricing.bike = parseFloat(price);
  }
  
  if (document.getElementById("vehicleBus").checked) {
    const price = document.getElementById("priceBus").value;
    if (!price) {
      alert("Please enter price for Bus");
      return;
    }
    vehicleTypes.push("bus");
    pricing.bus = parseFloat(price);
  }
  
  if (document.getElementById("vehicleHeavy").checked) {
    const price = document.getElementById("priceHeavy").value;
    if (!price) {
      alert("Please enter price for Heavy Vehicle");
      return;
    }
    vehicleTypes.push("heavy");
    pricing.heavy = parseFloat(price);
  }

  if (!notes || !lat || !lng) {
    alert("Fill all fields and select location");
    return;
  }

  if (vehicleTypes.length === 0) {
    alert("Please select at least one vehicle type");
    return;
  }

  if (files.length !== 3) {
    alert("Please upload exactly 3 images");
    return;
  }

  const formData = new FormData();
  formData.append("notes", notes);
  formData.append("ownerId", ownerId);
  formData.append("lat", lat);
  formData.append("lng", lng);
  formData.append("vehicleTypes", JSON.stringify(vehicleTypes));
  formData.append("pricing", JSON.stringify(pricing));

  for (let i = 0; i < files.length; i++) {
    formData.append("images", files[i]);
  }

  fetch(getApiUrl("/api/parking/register"), {
    method: "POST",
    body: formData,
  })
    .then(res => res.json())
    .then(data => {
      if (!data.success) {
        alert("Failed to register parking");
        return;
      }

      alert("Parking registered successfully!");
      window.location.href = "dashboard.html";
    })
    .catch(() => alert("Server error"));
}
</script>

<!-- ‚ö†Ô∏è PUT YOUR GOOGLE MAPS API KEY -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzFgFejKDyyFfXqdOfaKmjPiAmXVHHZS4&callback=initMap"
  async defer>
</script>

</body>
</html>
